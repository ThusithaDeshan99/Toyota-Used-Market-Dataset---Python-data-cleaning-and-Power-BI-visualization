# -*- coding: utf-8 -*-
"""Toyota used car market

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1xhWCC-xXqqjLyUUJRzsW2ENPZY79Rxds
"""

from google.colab import files

uploaded = files.upload()

import pandas as pd
import numpy as np
df = pd.read_csv("toyota used cars market.csv")

df.head()
df.info()
df.shape

#clean the column names
df.columns = (
    df.columns
    .str.strip()
    .str.lower()
    .str.replace(" ", "_")
)

#remove dup
df = df.drop_duplicates()

#check missings
df.isnull().sum()

#drop critical rows
df = df.dropna(subset=["price", "year", "mileage"])

#fill numeric columns with median
num_cols = ["tax", "mpg", "enginesize"]

for col in num_cols:
    df[col] = df[col].fillna(df[col].median())

#cleaning text columns
text_cols = ["model", "transmission", "fueltype"]

for col in text_cols:
    df[col] = df[col].str.strip().str.title()

"""standarization"""

df["transmission"] = df["transmission"].replace({
    "manual": "Manual",
    "automatic": "Automatic",
    "Auto": "Automatic",
    "semi auto": "Semi-Auto",
    "Semi Auto": "Semi-Auto"
})

df["fueltype"] = df["fueltype"].replace({
    "petrol": "Petrol",
    "diesel": "Diesel",
    "hybrid": "Hybrid",
    "Petrol Hybrid": "Hybrid",
    "other": "Other"
})

#convert data types
numeric_cols = [
    "year", "price", "mileage",
    "tax", "mpg", "enginesize"
]

df[numeric_cols] = df[numeric_cols].apply(
    pd.to_numeric, errors="coerce"
)

#invalid removel
df = df[(df["year"] >= 1990) & (df["year"] <= 2025)]

df = df[(df["price"] > 0) & (df["mileage"] >= 0)]

#handle outliers
def remove_outliers(df, col):
    Q1 = df[col].quantile(0.25)
    Q3 = df[col].quantile(0.75)
    IQR = Q3 - Q1
    return df[(df[col] >= Q1 - 1.5 * IQR) &
              (df[col] <= Q3 + 1.5 * IQR)]

for col in ["price", "mileage", "mpg"]:
    df = remove_outliers(df, col)

df["car_age"] = 2025 - df["year"]

df.isnull().sum()

df.to_csv("toyota_used_cars_cleaned.csv", index=False)

files.download("toyota_used_cars_cleaned.csv")